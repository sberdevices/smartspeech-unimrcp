From 1020c5616e6ce863c920f3c2ec27ac734a7099bf Mon Sep 17 00:00:00 2001
From: Arsen Chaloyan <achaloyan@gmail.com>
Date: Wed, 27 Nov 2013 16:57:32 -0800
Subject: [PATCH 3/6] Added pre-generated apr_escape_test_char.h for unix and
 windows respectively. Changed Makefile.in accordingly.

---
 Makefile.in                               | 13 +++----------
 include/arch/unix/apr_escape_test_char.h  | 23 +++++++++++++++++++++++
 include/arch/win32/apr_escape_test_char.h | 23 +++++++++++++++++++++++
 3 files changed, 49 insertions(+), 10 deletions(-)
 create mode 100644 include/arch/unix/apr_escape_test_char.h
 create mode 100644 include/arch/win32/apr_escape_test_char.h

diff --git a/Makefile.in b/Makefile.in
index a2a5194..4cfbacf 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -18,7 +18,7 @@ APR_MAJOR_VERSION=@APR_MAJOR_VERSION@
 INCDIR=./include
 OSDIR=$(top_srcdir)/include/arch/@OSDIR@
 DEFOSDIR=$(INCDIR)/arch/@DEFAULT_OSDIR@
-INCLUDES=-I$(INCDIR) -I$(OSDIR) -I$(DEFOSDIR) -I$(top_srcdir)/include/arch/@DEFAULT_OSDIR@ -I$(top_srcdir)/include -I$(top_srcdir)/include/private -I$(top_blddir)/include/private
+INCLUDES=-I$(INCDIR) -I$(OSDIR) -I$(DEFOSDIR) -I$(top_srcdir)/include/arch/@DEFAULT_OSDIR@ -I$(top_srcdir)/include -I$(top_srcdir)/include/private
 
 #
 # Macros for target determination
@@ -36,7 +36,7 @@ INSTALL_DATA = @INSTALL_DATA@
 # Rules for building specific targets, starting with 'all' for
 # building the entire package.
 #
-TARGETS = $(TARGET_LIB) include/private/apr_escape_test_char.h apr.exp apr-config.out build/apr_rules.out
+TARGETS = $(TARGET_LIB) apr.exp apr-config.out build/apr_rules.out
 
 LT_VERSION = @LT_VERSION@
 
@@ -46,8 +46,7 @@ LT_VERSION = @LT_VERSION@
 
 CLEAN_TARGETS = apr-config.out apr.exp exports.c export_vars.c .make.dirs \
 	build/apr_rules.out tools/gen_test_char@EXEEXT@ \
-	tools/gen_test_char.o tools/gen_test_char.lo \
-	include/private/apr_escape_test_char.h
+	tools/gen_test_char.o tools/gen_test_char.lo
 DISTCLEAN_TARGETS = config.cache config.log config.status \
 	include/apr.h include/arch/unix/apr_private.h \
 	libtool $(APR_CONFIG) build/apr_rules.mk apr.pc \
@@ -101,8 +100,6 @@ install: $(TARGETS)
 $(TARGET_LIB): $(OBJECTS)
 	$(LINK) @lib_target@ $(ALL_LIBS)
 
-encoding/apr_escape.lo: include/private/apr_escape_test_char.h 
-
 exports.c: $(HEADERS)
 	$(APR_MKEXPORT) $(HEADERS) > $@
 
@@ -137,10 +134,6 @@ tools/gen_test_char.lo: tools/gen_test_char.c
 tools/gen_test_char@EXEEXT@: $(OBJECTS_gen_test_char)
 	$(LINK_PROG) $(OBJECTS_gen_test_char) $(ALL_LIBS)
 
-include/private/apr_escape_test_char.h: tools/gen_test_char@EXEEXT@
-	$(APR_MKDIR) include/private
-	tools/gen_test_char@EXEEXT@ > $@
-
 LINK_PROG = $(LIBTOOL) $(LTFLAGS) --mode=link $(COMPILE) $(LT_LDFLAGS) \
 	    @LT_NO_INSTALL@ $(ALL_LDFLAGS) -o $@
 
diff --git a/include/arch/unix/apr_escape_test_char.h b/include/arch/unix/apr_escape_test_char.h
new file mode 100644
index 0000000..3cb8443
--- /dev/null
+++ b/include/arch/unix/apr_escape_test_char.h
@@ -0,0 +1,23 @@
+/* this file is automatically generated by gen_test_char, do not edit. "make include/private/apr_escape_test_char.h" to regenerate. */
+#define T_ESCAPE_SHELL_CMD     (1)
+#define T_ESCAPE_PATH_SEGMENT  (2)
+#define T_OS_ESCAPE_PATH       (4)
+#define T_ESCAPE_ECHO          (8)
+#define T_ESCAPE_URLENCODED    (16)
+#define T_ESCAPE_XML           (32)
+
+static const unsigned char test_char_table[256] = {
+    32,30,30,30,30,30,30,30,30,30,31,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,6,16,63,22,17,22,49,17,
+    17,17,1,16,16,0,0,18,0,0,0,0,0,0,0,0,0,0,16,23,
+    55,16,55,23,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
+    0,0,0,0,0,0,0,0,0,0,0,23,31,23,23,0,23,0,0,0,
+    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
+    0,0,0,23,23,23,17,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30 
+};
diff --git a/include/arch/win32/apr_escape_test_char.h b/include/arch/win32/apr_escape_test_char.h
new file mode 100644
index 0000000..7f04535
--- /dev/null
+++ b/include/arch/win32/apr_escape_test_char.h
@@ -0,0 +1,23 @@
+/* this file is automatically generated by gen_test_char, do not edit. "make include/private/apr_escape_test_char.h" to regenerate. */
+#define T_ESCAPE_SHELL_CMD     (1)
+#define T_ESCAPE_PATH_SEGMENT  (2)
+#define T_OS_ESCAPE_PATH       (4)
+#define T_ESCAPE_ECHO          (8)
+#define T_ESCAPE_URLENCODED    (16)
+#define T_ESCAPE_XML           (32)
+
+static const unsigned char test_char_table[256] = {
+    32,30,30,30,30,30,30,30,30,30,31,30,30,31,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,6,16,63,22,17,23,49,17,
+    17,17,1,16,16,0,0,18,0,0,0,0,0,0,0,0,0,0,16,23,
+    55,16,55,23,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
+    0,0,0,0,0,0,0,0,0,0,0,23,31,23,23,0,23,0,0,0,
+    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
+    0,0,0,23,23,23,17,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
+    30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30 
+};
-- 
2.8.1.windows.1

